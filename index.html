<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>LINE æ–‡æ¡ˆä¸€éµå»(emoji) æ¸…ç†å™¨ï½œv15.3</title>
<style>
  :root{--bg:#fafafa;--card:#fff;--ink:#111827;--muted:#6b7280;--line:#e5e7eb;--accent:#111827}
  *{box-sizing:border-box} html,body{height:100%} body{margin:0;background:var(--bg);color:var(--ink);font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans TC",Helvetica,Arial}
  .container{max-width:1080px;margin:0 auto;padding:20px;line-height:1.5}
  h1{font-size:clamp(20px,3.6vw,28px);margin:0 0 4px}
  .sub{color:var(--muted);font-size:12px}
  .grid{display:grid;gap:16px}
  @media(min-width:980px){.grid.two{grid-template-columns:1fr 1fr} .grid.three{grid-template-columns:1fr 1fr 1fr}}
  .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:16px;box-shadow:0 1px 2px rgba(0,0,0,.04)}
  .card h2{font-size:18px;margin:0 0 12px}
  textarea,input[type="text"],input[type="tel"]{width:100%;border:1px solid var(--line);border-radius:12px;padding:10px 12px;font:12px/1.5 ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;background:#fff;outline:none}
  textarea{height:340px;resize:vertical} .output{background:#f8fafc}
  .row{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}
  .btn{appearance:none;border:1px solid var(--line);border-radius:999px;background:#fff;padding:8px 12px;font-size:13px;cursor:pointer}
  .btn.primary{background:var(--accent);border-color:var(--accent);color:#fff}
  .muted{color:var(--muted);font-size:12px} .opt{display:flex;align-items:center;gap:8px;font-size:13px;margin:6px 0}
  .error{color:#b91c1c;font-size:12px}
  .inline{display:flex;gap:8px;flex-wrap:wrap} .inline .field{flex:1 1 180px} .field label{display:block;font-size:12px;color:#6b7280;margin:0 0 4px}
  footer{margin-top:20px;color:var(--muted);font-size:13px;text-align:center;line-height:1.6}
  .pill{padding:4px 8px;border:1px dashed var(--line);border-radius:999px;font-size:12px;color:var(--muted)}
  .ig-link{display:inline-flex;align-items:center;gap:6px;color:inherit;text-decoration:none}
  .ig-link:hover{text-decoration:underline}
</style>
</head>
<body>
  <div class="container">
    <header style="display:flex;justify-content:space-between;align-items:baseline;gap:12px;flex-wrap:wrap">
      <h1>LINE æ–‡æ¡ˆä¸€éµå» (emoji) æ¸…ç†å™¨ <small class="pill">v15.3</small></h1>
      <div class="sub">çŸ­ç¶²å€å“¡ç·¨è¦†è“‹ã€é•·ç¶²å€è£œå“¡ç·¨ã€emojiæ¸…ç†ã€è‡ªå‹•åµŒå…¥å‹•æ…‹æ¬„ä½ã€‚</div>
    </header>

    <div class="grid two">
      <div class="card">
        <h2>è²¼ä¸Šä¾†æºæ–‡å­—</h2>
        <textarea id="input" placeholder="æŠŠ LINE è¤‡è£½ä¾†çš„æ–‡æ¡ˆè²¼åœ¨é€™è£¡â€¦"></textarea>
        <div class="row">
          <button class="btn" id="clear">æ¸…ç©º</button>
          <button class="btn" id="copyRaw">è¤‡è£½åŸæ–‡</button>
          <button class="btn" id="loadDemo">è¼‰å…¥ç¯„ä¾‹</button>
        </div>
      </div>
      <div class="card">
        <h2>æ¸…ç†å¾Œè¼¸å‡º</h2>
        <textarea id="output" class="output" readonly></textarea>
        <div class="row">
          <button class="btn primary" id="copyClean">è¤‡è£½æ·¨åŒ–æ–‡å­—</button>
          <button class="btn" id="applyLeft">å¥—ç”¨åˆ°å·¦å´</button>
        </div>
      </div>
    </div>

    <div class="grid three" style="margin-top:16px">
      <div class="card">
        <h2>æ¸…ç†é¸é …</h2>
        <label class="opt"><input type="checkbox" id="live" checked>å³æ™‚æ¸…ç† (Live)</label>
        <label class="opt"><input type="checkbox" id="aggr">Aggressiveï¼šç§»é™¤ç´”å­—æ¯/ä¸­æ–‡æ‹¬è™Ÿï¼ˆå¦‚ (emoji)ã€(è²¼åœ–)ï¼‰</label>
        <label class="opt"><input type="checkbox" id="fixDigits" checked>ä¿®å¾©æ•¸å­—æ‹¬è™Ÿï¼š<code>(9)(0)(0) â†’ 900</code></label>
        <label class="opt"><input type="checkbox" id="fixWordDigits" checked>ä¿®å¾©è‹±æ–‡æ•¸å­—æ‹¬è™Ÿï¼š<code>(one)(zero)(zero) â†’ 100</code></label>
        <label class="opt"><input type="checkbox" id="fixBye" checked>ä¿®å¾© <code>(å†æœƒ)</code> â†’ 8</label>
        <label class="opt"><input type="checkbox" id="trim" checked>ç§»é™¤å¤šé¤˜ç©ºç™½ï¼ˆä¸å½±éŸ¿æ›è¡Œï¼‰</label>
        <label class="opt"><input type="checkbox" id="collapse" checked>ç§»é™¤å¤šé¤˜ç©ºè¡Œï¼ˆé€£çºŒç©ºè¡Œ â†’ å–®ä¸€ç©ºè¡Œï¼‰</label>
        <div id="err" class="error" style="display:none"></div>
      </div>
      <div class="card">
        <h2>å‹•æ…‹æ¬„ä½ï¼ˆè‡ªå‹•åµŒå…¥æ–‡æ¡ˆï¼‰</h2>
        <div class="inline">
          <div class="field"><label>å“¡å·¥ç·¨è™Ÿ</label><input id="empId" type="text" placeholder="362102"></div>
          <div class="field"><label>åº—å</label><input id="store" type="text" placeholder="æˆåŠŸæ¼¢ç¥åº—"></div>
          <div class="field"><label>å§“å</label><input id="name" type="text" placeholder="é‚±å‰ç¶¸"></div>
          <div class="field"><label>é›»è©±</label><input id="phone" type="tel" placeholder="0978658101"></div>
          <div class="field"><label>LINE ID</label><input id="lineid" type="text" placeholder="yourlineid"></div>
        </div>
        <p class="muted">æ”¯æ´ç¶²å€åƒæ•¸é å¡«ï¼š<code>?store=æˆåŠŸæ¼¢ç¥åº—&name=é‚±å‰ç¶¸&phone=0978...&lineid=myline&emp=362102</code>ï¼›æ¬„ä½æœƒè‡ªå‹•è¨˜ä½ã€‚</p>
      </div>
      <div class="card">
        <h2>è‡ªè¨‚è¦å‰‡ï¼ˆé¸å¡«ï½œæ­£å‰‡ï¼‰</h2>
        <input id="custom" type="text" placeholder="è¼¸å…¥æ­£å‰‡ï¼Œå¦‚ï¼š\((?:å°ç†Šç¶­å°¼|å¯æ„›è²¼åœ–)\) æˆ– \[(?:emoji|è²¼åœ–)\]">
        <p class="muted">ç•™ç©ºä¹Ÿèƒ½è™•ç† 90% æ¡ˆä¾‹ï¼›è‹¥å¡«å¯«éŒ¯èª¤å°‡é¡¯ç¤ºç´…å­—æé†’ã€‚</p>
      </div>
    </div>

    <footer>
      <p>GitHub Pages ç‰ˆ v15.3</p>
      <p>è£½ä½œè€…ï¼šChatGPT-5 ï½œ æ§‹æƒ³äººï¼š362102 é‚±å‰ç¶¸ ï½œ IGï¼š
        <a class="ig-link" href="https://www.instagram.com/chiuyourhouse?igsh=MXZxaDd6YTE2eno3ZA%3D%3D&utm_source=qr" target="_blank">
          <svg aria-hidden="true" viewBox="0 0 24 24" width="16" height="16" style="vertical-align:middle">
            <path fill="currentColor" d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5zm0 2a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V7a3 3 0 0 0-3-3H7zm5 3.5a5.5 5.5 0 1 1 0 11.001A5.5 5.5 0 0 1 12 7.5zm0 2a3.5 3.5 0 1 0 0 7.001 3.5 3.5 0 0 0 0-7.001zM17.8 6.2a1 1 0 1 1 0 2.001 1 1 0 0 1 0-2.001z"/>
          </svg>
          <span style="margin-left:6px">CHIU YOUR HOUSE</span>
        </a>
      </p>
    </footer>
  </div>

<script>
(function(){
  const $ = id=>document.getElementById(id);
  const elIn=$("input"), elOut=$("output");
  const elLive=$("live"), elAggr=$("aggr"), elFixDigits=$("fixDigits"), elFixWordDigits=$("fixWordDigits"), elFixBye=$("fixBye"), elTrim=$("trim"), elCollapse=$("collapse");
  const elErr=$("err"), elCustom=$("custom");
  const empId=$("empId"), store=$("store"), name=$("name"), phone=$("phone"), lineid=$("lineid");
  const btnCopyRaw=$("copyRaw"), btnCopyClean=$("copyClean"), btnApplyLeft=$("applyLeft"), btnClear=$("clear"), btnLoadDemo=$("loadDemo");

  const demo=`å¤§é™åƒ¹âœ…å»ºåœ‹è·¯ä¸€æ®µæ­£è·¯é€åº—
(1)(six)(5)(0)è¬
åœŸåœ°ç™»è¨˜ (3)(2).(6)(7) åª
ğŸ”¹æ­£è·¯é€å¤©åç›®
ç¶²å€ï¼šhttps://sinyi.in/o/4407RM/424121`;

  const LS_KEY="line_cleaner_profile_v1";
  function saveProfile(){ const d={emp:empId.value, store:store.value, name:name.value, phone:phone.value, lineid:lineid.value}; try{localStorage.setItem(LS_KEY, JSON.stringify(d));}catch(e){} }
  function loadProfile(){
    let d={}; try{d=JSON.parse(localStorage.getItem(LS_KEY)||"{}");}catch(e){}
    const url=new URL(location.href), qp=k=>url.searchParams.get(k)||"";
    empId.value=qp("emp")||d.emp||empId.placeholder;
    store.value=qp("store")||d.store||store.placeholder;
    name.value=qp("name")||d.name||name.placeholder;
    phone.value=qp("phone")||d.phone||phone.placeholder;
    lineid.value=qp("lineid")||d.lineid||lineid.placeholder;
  }
  loadProfile();

  function buildRegexes(){
    const list=[];
    // --- ä¸ç§»é™¤ (one..nine)ï¼›å…¶é¤˜ (è‹±æ–‡)æœƒç§»é™¤ ---ï¼ˆåœ¨ clean() è£¡è™•ç†ç‰¹æ®Šä¿ç•™ï¼‰
    list.push(/\[(?:emoji|sticker|line\s*emoji|è²¼åœ–|è¡¨æƒ…)\]/gi);
    list.push(/<\s*(?:emoji|sticker)\s*>/gi);
    list.push(/\{\s*(?:emoji|sticker)\s*\}/gi);
    list.push(/:(?:emoji|sticker|è¡¨æƒ…|è²¼åœ–):/gi);
    if (elAggr.checked) list.push(/\(([A-Za-z\u4E00-\u9FFF]+(?:\s+[A-Za-z\u4E00-\u9FFF]+)*)\)/g);
    const custom=elCustom.value.trim();
    if(custom){ try{ const m=custom.match(/^\/(.+)\/([a-z]*)$/i); const rx=m?new RegExp(m[1], m[2]||"g"):new RegExp(custom,"g"); list.push(rx); elErr.style.display="none"; elErr.textContent=""; } catch(e){ elErr.style.display="block"; elErr.textContent="è‡ªè¨‚æ­£å‰‡æ ¼å¼æœ‰èª¤"; } }
    else { elErr.style.display="none"; elErr.textContent=""; }
    return list;
  }

  function mapWordDigits(t){ if(!elFixWordDigits.checked) return t; const map={zero:'0',one:'1',two:'2',three:'3',four:'4',five:'5',six:'6',seven:'7',eight:'8',nine:'9'}; return t.replace(/\((zero|one|two|three|four|five|six|seven|eight|nine)\)/gi,(_,w)=>map[w.toLowerCase()]||_); }
  function fixBracketDigits(t){ if(!elFixDigits.checked) return t; return t.replace(/(\(\d\)){1,}/g, m=>m.replace(/[()]/g,"")); }
  function stripOriginalPhones(t){
    let out=t.replace(/^.*?ç°¡è¨Šè«‹ç™¼.*$/gmi,"");
    out=out.replace(/(?:\+?886[-\s]?)?09\d{2}[-\s]?\d{3}[-\s]?\d{3}/g,"");
    out=out.replace(/0\d{1,2}[-\s]?\d{6,8}/g,"");
    out=out.replace(/[,ï¼Œ]\s*(?=\n)/g,"");
    out=out.replace(/^\s*(æœå‹™å°ˆç·š|ç°¡è¨Šè«‹ç™¼)\s*[:ï¼š]?\s*$/gmi,"");
    out=out.replace(/^\s*æ´½[^\n]*?åº—[^\n]*$/gmi,"");
    return out;
  }

  function fixSinyiShortLinks(t){
    const eid=empId.value.trim(); if(!eid) return t;
    return t.replace(/https?:\/\/sinyi\.in\/o\/([A-Za-z0-9]+)\/(\d+)(?:\/(\d+))?(?:\/([A-Za-z\u4e00-\u9fa5]+))?/g, (m, code, n1, n2, tail) => {
      let url = `https://sinyi.in/o/${code}/${eid}`;
      if (tail) url += `/${tail}`;
      return url;
    });
  }
  function fixSinyiFullLinks(t){
    const eid=empId.value.trim(); if(!eid) return t;
    return t.replace(/https?:\/\/www\.sinyi\.com\.tw\/buy\/house\/([A-Za-z0-9]+)\/(\d+)(?:\/(\d+))?/g, (m, code, id, old) => {
      return `https://www.sinyi.com.tw/buy/house/${code}/${id}/${eid}`;
    });
  }
  function removeBrandFromBody(t){
    let out=t.replace(/\u3000/g," ");
    out=out.replace(/^.*ä¿¡ç¾©æˆ¿å±‹.*åº—.*$/gmi,"");
    out=out.replace(/ä¿¡ç¾©æˆ¿å±‹[^\n]*?åº—[ \t]*\S+/g,"");
    out=out.replace(/æ´½[^\n]*?åº—[ \t]*\S+/g,"");
    out=out.replace(/^\s*[\u4e00-\u9fa5]{2,5}\s*[ï¼Œ,ã€‚.\-â€“â€”]*\s*$/gm,"");
    out=out.replace(/[ \t]+\n/g,"\n").replace(/\n{3,}/g,"\n\n");
    return out;
  }
  function buildContactBlock(){
    const s=store.value.trim(), n=name.value.trim();
    const phoneStr=phone.value.trim()?`é›»è©±ï¼š${phone.value.trim()}\n`:"";
    const lineStr=lineid.value.trim()?`LINE IDï¼š${lineid.value.trim()}\n`:"";
    const brand=(s||n)?`ä¿¡ç¾©æˆ¿å±‹${s?s:""}${s&&n?" ":""}${n?n:""}\n`:"";
    return brand+phoneStr+lineStr;
  }
  function insertContactsBeforeFirstUrl(t){
    const block=buildContactBlock(); if(!block) return t;
    const urlLineRegex=/^(?=.*https?:\/\/)\S.*$|^\s*(?:ç¶²å€|é€£çµ)\s*[:ï¼š]?\s*https?:\/\/.*$/gmi;
    let inserted=false;
    let out=t.replace(urlLineRegex,(m)=>{ if(inserted) return m; inserted=true; return block+m; });
    if(!inserted){ out=out.replace(/\s*$/,"\n"+block); }
    return out;
  }

  function clean(text){
    let out=text;
    // å…ˆä¿ç•™ (zero..nine) èˆ‡ (æ•¸å­—)ï¼Œåˆªé™¤å…¶ä»– (è‹±æ–‡) æ¨™è¨˜
    out = out.replace(/\(([A-Za-z\s]+)\)/g, (m, w) => {
      const s = w.trim().toLowerCase();
      const keep = ['zero','one','two','three','four','five','six','seven','eight','nine'];
      return keep.includes(s) ? m : '';
    });
    // ä¸€èˆ¬ emoji/è²¼åœ–æ¨™è¨˜æ¸…é™¤
    const regs=buildRegexes(); for(const rx of regs) out=out.replace(rx,"");
    // æ¸…ç†ç©ºç™½
    out=out.replace(/[\u3000\t]+/g," ").replace(/ {2,}/g," ").replace(/^\s+|\s+$/gm,"").replace(/\n{3,}/g,"\n\n");
    // å¾Œè™•ç†ï¼šæ•¸å­—ç¿»è­¯ã€å»æ‹¬è™Ÿã€æ´—é›»è©±ç­‰
    if (out.includes("(å†æœƒ)")) out=out.replace(/\(å†æœƒ\)/g,"8");
    out=mapWordDigits(out);
    out=fixBracketDigits(out);
    out=stripOriginalPhones(out);
    out=fixSinyiShortLinks(out);
    out=fixSinyiFullLinks(out);
    out=removeBrandFromBody(out);
    out=insertContactsBeforeFirstUrl(out);
    return out;
  }

  function render(){ elOut.value=clean(elIn.value); saveProfile(); }
  ["input","keyup","change"].forEach(ev=>{
    [elIn,elCustom,elAggr,elTrim,elCollapse,elFixDigits,elFixWordDigits,elFixBye,empId,store,name,phone,lineid,elLive].forEach(el=>el.addEventListener(ev, render));
  });
  function copyText(text){ if(navigator.clipboard&&isSecureContext){return navigator.clipboard.writeText(text).catch(()=>fallback());} else return fallback();
    function fallback(){ const ta=document.createElement("textarea"); ta.value=text; document.body.appendChild(ta); ta.select(); document.execCommand("copy"); ta.remove(); return Promise.resolve(); } }
  btnCopyRaw.addEventListener("click", ()=>copyText(elIn.value).then(()=>alert("å·²è¤‡è£½åŸæ–‡")));
  btnCopyClean.addEventListener("click", ()=>copyText(elOut.value).then(()=>alert("å·²è¤‡è£½æ·¨åŒ–æ–‡å­—")));
  btnApplyLeft.addEventListener("click", ()=>{ elIn.value=elOut.value; render(); });
  btnClear.addEventListener("click", ()=>{ elIn.value=""; render(); });
  btnLoadDemo.addEventListener("click", ()=>{ elIn.value=demo; render(); });
  render();
})();
</script>
</body>
</html>
